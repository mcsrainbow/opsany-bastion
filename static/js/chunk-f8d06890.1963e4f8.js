(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f8d06890"],{"3cba":function(t,e,a){},b899:function(t,e,a){"use strict";a.d(e,"f",(function(){return o})),a.d(e,"b",(function(){return i})),a.d(e,"a",(function(){return s})),a.d(e,"g",(function(){return c})),a.d(e,"c",(function(){return r})),a.d(e,"d",(function(){return l})),a.d(e,"e",(function(){return d}));var n=a("b775"),o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["b"])({url:"session-log/",method:"get",params:t})},i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["b"])({url:"session-log/",method:"delete",data:t})},s=window.location.origin+window.API_ROOT+"api/bastion/v0_1/",c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return s+"session-log/guacamole/"+"".concat(t,"/")},r=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["b"])({url:"command-log/",method:"get",params:t})},l=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["b"])({url:"operation-log/",method:"get",params:t})},d=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["b"])({url:"session-command-history/",method:"get",params:t})}},d021:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"online_main"},[a("ContentHeader",[a("div",{attrs:{slot:"docs"},slot:"docs"},[t._v(" 当前正在使用堡垒机的登录会话，操作强制下线会中断用户的当前请求链接。 ")])]),a("a-card",[a("div",{staticClass:"search_box"},[a("a-input-search",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入关键字搜索",allowClear:""},on:{search:t.searchTable},model:{value:t.pagination.search_data,callback:function(e){t.$set(t.pagination,"search_data",e)},expression:"pagination.search_data"}},[a("a-select",{staticStyle:{width:"100px"},attrs:{slot:"addonBefore"},slot:"addonBefore",model:{value:t.pagination.search_type,callback:function(e){t.$set(t.pagination,"search_type",e)},expression:"pagination.search_type"}},t._l(t.searchList,(function(e){return a("a-select-option",{key:e.key},[t._v(t._s(e.name))])})),1)],1),a("a-button",{staticStyle:{float:"right"},attrs:{icon:"reload"},on:{click:t.refresh}},[t._v("刷新")])],1),a("a-table",{attrs:{loading:t.tableLoading,pagination:t.pagination,"row-selection":{selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange},columns:t.columns,"data-source":t.tableData},on:{change:t.onChange},scopedSlots:t._u([{key:"action",fn:function(e,n){return[t.$store.state.btnAuth.btnAuth.bastion_session_off_line?a("a",{on:{click:function(e){return t.offline(n)}}},[t._v("强制下线")]):t._e()]}}])}),t.tableData.length>0?a("a-button",{staticStyle:{float:"left",margin:"-50px 10px 0 0"},attrs:{disabled:0==t.selectedRow.length,icon:"delete"},on:{click:t.batchDelete}},[t._v("批量下线")]):t._e()],1)],1)},o=[],i=(a("d81d"),a("d3b7"),a("0977")),s=a("b899"),c={data:function(){return{tableData:[],pagination:{total:0,current:1,pageSize:10,showTotal:function(t){return"共有 ".concat(t," 条数据")},search_type:"user",search_data:void 0,showSizeChanger:!0,showQuickJumper:!0},tableLoading:!1,columns:[{title:"登录用户",dataIndex:"user"},{title:"主机",dataIndex:"host_name"},{title:"IP地址",dataIndex:"host_address",width:"170px"},{title:"系统用户",dataIndex:"login_name"},{title:"开始时间",dataIndex:"start_time"},{title:"操作",key:"action",scopedSlots:{customRender:"action"},align:"center"}],searchList:[{name:"登录用户",key:"user"},{name:"主机",key:"server"}],selectedRowKeys:[],selectedRow:[]}},mounted:function(){this.getSessionLogData()},methods:{onSelectChange:function(t,e){this.selectedRow=e,this.selectedRowKeys=t},getSessionLogData:function(){var t=this;this.tableLoading=!0;var e={current:this.pagination.current,pageSize:this.pagination.pageSize};this.pagination.search_data&&("server"==this.pagination.search_type?e.search_type="host__host_name":e.search_type=this.pagination.search_type,e.search_data=this.pagination.search_data),Object(s["f"])(e).then((function(e){200==e.code&&e.data?(t.pagination.total=e.data.total,t.pagination.current=e.data.current,t.pagination.pageSize=e.data.pageSize,e.data.data.map((function(t){t.key=t.id})),t.tableData=e.data.data,t.selectedRow=[]):t.tableData=[]})).finally((function(){t.tableLoading=!1}))},searchTable:function(t){this.search_data=t,this.pagination.current=1,this.getSessionLogData()},refresh:function(){this.getSessionLogData()},onChange:function(t){this.pagination.total=t.total,this.pagination.current=t.current,this.pagination.pageSize=t.pageSize,this.getSessionLogData()},offline:function(t){var e=this,a={log_name:t.log_name,channel:t.channel};this.$confirm({title:"强制下线确认",content:"请确认是否强制下线此连接?",okType:"danger",onOk:function(){Object(s["b"])({session_list:[a]}).then((function(t){e.$message.success("操作成功"),e.getSessionLogData()}))}})},batchDelete:function(){var t=this;this.$confirm({title:"确认删除该分组吗？",onOk:function(){var e=[];t.selectedRow.map((function(t){e.push({log_name:t.log_name,channel:t.channel})})),Object(s["b"])({session_list:e}).then((function(e){200==e.code&&(t.$message.success(e.message),t.getSessionLogData(),t.selectedRowKeys=[])}))}})}},components:{ContentHeader:i["a"]}},r=c,l=(a("d95b"),a("2877")),d=Object(l["a"])(r,n,o,!1,null,"dea0a7ca",null);e["default"]=d.exports},d95b:function(t,e,a){"use strict";var n=a("3cba"),o=a.n(n);o.a}}]);