(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3168254b"],{"4bbf":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"history_main"},[n("ContentHeader",[n("div",{attrs:{slot:"docs"},slot:"docs"},[t._v("所有堡垒机登录的会话，审计查看可以播放会话的执行详情，用于做安全审核。")])]),n("a-card",[n("div",{staticClass:"search_box"},[n("a-input-search",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入关键字搜索",allowClear:""},on:{search:t.searchTable},model:{value:t.pagination.search_data,callback:function(e){t.$set(t.pagination,"search_data",e)},expression:"pagination.search_data"}},[n("a-select",{staticStyle:{width:"100px"},attrs:{slot:"addonBefore"},slot:"addonBefore",model:{value:t.pagination.search_type,callback:function(e){t.$set(t.pagination,"search_type",e)},expression:"pagination.search_type"}},t._l(t.searchList,(function(e){return n("a-select-option",{key:e.key},[t._v(t._s(e.name))])})),1)],1),n("a-button",{staticStyle:{float:"right"},attrs:{icon:"reload"},on:{click:t.refresh}},[t._v("刷新")])],1),n("a-table",{attrs:{loading:t.tableLoading,pagination:t.pagination,columns:t.columns,"data-source":t.tableData},on:{change:t.onChange},scopedSlots:t._u([{key:"action",fn:function(e,a){return[n("a",{staticStyle:{margin:"0 10px 0 0"},on:{click:function(e){return t.preview(a)}}},[t._v("播放历史")]),n("a",{attrs:{disabled:"Linux"!=a.system_type},on:{click:function(e){return t.$router.push({path:"/auditManagement/historical/historicalDetails",query:{id:a.id}})}}},[t._v("查看详情")])]}}])})],1),n("WindowsPlayer",{ref:"WindowsPlayer"}),n("PlayerModel",{ref:"PlayerModel"})],1)},i=[],o=(n("d81d"),n("d3b7"),n("96cf"),n("1da1")),r=n("0977"),s=n("b899"),c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("a-modal",{attrs:{title:"审计查看",visible:t.visible,maskClosable:!1,"confirm-loading":t.confirmLoading,width:"100%",destroyOnClose:"","dialog-style":{top:"0"},zIndex:1e3},on:{ok:t.handleOk,cancel:t.handleCancel}},[n("div",{attrs:{id:"player_box"},on:{click:t.start,mousemove:t.mousemove}},[n("a-icon",{ref:"icons",staticClass:"icons",attrs:{type:t.iconType,id:"icons"}})],1)])],1)},l=[],d=n("a9c6"),u=n.n(d),h={data:function(){return{visible:!1,confirmLoading:!1,recording:{},iconType:"play-circle",timer:null}},methods:{show:function(t){var e=this;this.visible=!0;var n=Object(s["g"])(t);this.$nextTick((function(){var t=document.getElementById("player_box"),a=new u.a.StaticHTTPTunnel(n,!0),i=new u.a.SessionRecording(a);e.recording=i;var o=i.getDisplay(),r=o.getElement();t.appendChild(r),i.connect(),e.$nextTick((function(){r.style.margin="0 auto"})),i.onplay=function(){e.iconType="pause-circle"},i.onpause=function(){e.iconType="play-circle"}}))},start:function(){this.recording.isPlaying()?this.recording.pause():this.recording.play()},mousemove:function(){var t=this;clearTimeout(this.timer),this.$nextTick((function(){var e=t.$refs.icons.$el;e.style.opacity=.5,t.timer=setTimeout((function(){e.style.opacity=0}),2e3)}))},handleOk:function(){this.visible=!1},handleCancel:function(){this.visible=!1}}},f=h,g=(n("e5c3"),n("2877")),p=Object(g["a"])(f,c,l,!1,null,"68d08ea0",null),m=p.exports,v=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("a-modal",{attrs:{title:"审计查看",visible:t.visible,maskClosable:!1,"confirm-loading":t.confirmLoading,width:"960px"},on:{ok:t.handleOk,cancel:t.handleCancel}},[n("div",{attrs:{id:"player_box"},domProps:{innerHTML:t._s(t.asciinemaPlayerHtml)}})])],1)},y=[],b={data:function(){return{visible:!1,confirmLoading:!1,asciinemaPlayerHtml:""}},methods:{show:function(t){var e=this,n=s["a"]+"session-log/terminal/"+"".concat(t)+"/";this.visible=!0,this.asciinemaPlayerHtml="",this.$nextTick((function(){var t='<asciinema-player id="asciinemaPlayerHtml" cols="132"  src="'.concat(n,'"></asciinema-player>');e.asciinemaPlayerHtml=t}))},handleOk:function(){this.visible=!1},handleCancel:function(){this.visible=!1;var t=document.getElementById("player_box"),e=document.getElementById("asciinemaPlayerHtml");e&&t.removeChild(e)}},mounted:function(){}},_=b,w=Object(g["a"])(_,v,y,!1,null,"ab849abe",null),k=w.exports,x=n("6f7c"),S={data:function(){return{tableData:[],pagination:{total:0,current:1,pageSize:10,showTotal:function(t){return"共有 ".concat(t," 条数据")},search_type:"user",search_data:void 0,showSizeChanger:!0,showQuickJumper:!0},tableLoading:!1,columns:[{title:"登录用户",dataIndex:"user"},{title:"主机",dataIndex:"host_name"},{title:"IP地址",dataIndex:"host_address",width:"170px"},{title:"系统用户",dataIndex:"login_name"},{title:"开始时间",dataIndex:"start_time"},{title:"操作",key:"action",scopedSlots:{customRender:"action"},align:"center"}],searchList:[{name:"登录用户",key:"user"},{name:"主机",key:"server"}]}},mounted:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(x["a"])(t,"visit-history-session");case 2:n=e.sent,n&&t.getSessionLogData();case 4:case"end":return e.stop()}}),e)})))()},methods:{preview:function(t){if("Windows"==t.system_type)return this.$refs.WindowsPlayer.show(t.log_name);var e=t.log_name;this.$refs.PlayerModel.show(e)},searchTable:function(t){this.search_data=t,this.pagination.current=1,this.getSessionLogData()},getSessionLogData:function(){var t=this;this.tableLoading=!0;var e={current:this.pagination.current,pageSize:this.pagination.pageSize,finished:1};this.pagination.search_data&&("server"==this.pagination.search_type?e.search_type="host__host_name":e.search_type=this.pagination.search_type,e.search_data=this.pagination.search_data),Object(s["f"])(e).then((function(e){200==e.code&&e.data?(t.pagination.total=e.data.total,t.pagination.current=e.data.current,t.pagination.pageSize=e.data.pageSize,e.data.data.map((function(t){t.key=t.id})),t.tableData=e.data.data):t.tableData=[]})).finally((function(){t.tableLoading=!1}))},refresh:function(){this.getSessionLogData()},onChange:function(t){this.pagination.total=t.total,this.pagination.current=t.current,this.pagination.pageSize=t.pageSize,this.getSessionLogData()}},components:{ContentHeader:r["a"],WindowsPlayer:m,PlayerModel:k}},O=S,P=(n("cdd6"),Object(g["a"])(O,a,i,!1,null,"402dc2d7",null));e["default"]=P.exports},"6f7c":function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));n("d3b7");var a=n("a18c"),i=n("b775"),o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["b"])({url:"authentication/",method:"get",params:t})},r=function(){a["a"].push({name:"noAuth"})},s=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Promise((function(n,a){setTimeout((function(){t.$loading.show()}),0),o({action_id:e}).then((function(t){return t.data||r(),n(t.data)})).catch((function(){return r(),n(!1)})).finally((function(){setTimeout((function(){t.$loading.hide()}),0)}))}))}},b899:function(t,e,n){"use strict";n.d(e,"f",(function(){return i})),n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return r})),n.d(e,"g",(function(){return s})),n.d(e,"c",(function(){return c})),n.d(e,"d",(function(){return l})),n.d(e,"e",(function(){return d}));var a=n("b775"),i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(a["b"])({url:"session-log/",method:"get",params:t})},o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(a["b"])({url:"session-log/",method:"delete",data:t})},r=window.location.origin+window.API_ROOT+"api/bastion/v0_1/",s=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r+"session-log/guacamole/"+"".concat(t,"/")},c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(a["b"])({url:"command-log/",method:"get",params:t})},l=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(a["b"])({url:"operation-log/",method:"get",params:t})},d=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(a["b"])({url:"session-command-history/",method:"get",params:t})}},c1a6:function(t,e,n){},cdd6:function(t,e,n){"use strict";var a=n("f124"),i=n.n(a);i.a},e5c3:function(t,e,n){"use strict";var a=n("c1a6"),i=n.n(a);i.a},f124:function(t,e,n){}}]);