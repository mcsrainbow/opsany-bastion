(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2bfdc242"],{"1da1":function(t,a,n){"use strict";n.d(a,"a",(function(){return i}));n("d3b7");function e(t,a,n,e,i,o,r){try{var s=t[o](r),c=s.value}catch(u){return void n(u)}s.done?a(c):Promise.resolve(c).then(e,i)}function i(t){return function(){var a=this,n=arguments;return new Promise((function(i,o){var r=t.apply(a,n);function s(t){e(r,i,o,s,c,"next",t)}function c(t){e(r,i,o,s,c,"throw",t)}s(void 0)}))}}},"1f6d":function(t,a,n){"use strict";var e=n("bd48"),i=n.n(e);i.a},"6f7c":function(t,a,n){"use strict";n.d(a,"a",(function(){return s}));n("d3b7");var e=n("a18c"),i=n("b775"),o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["b"])({url:"authentication/",method:"get",params:t})},r=function(){e["a"].push({name:"noAuth"})},s=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Promise((function(n,e){setTimeout((function(){t.$loading.show()}),0),o({action_id:a}).then((function(t){return t.data||r(),n(t.data)})).catch((function(){return r(),n(!1)})).finally((function(){setTimeout((function(){t.$loading.hide()}),0)}))}))}},"8e49":function(t,a,n){"use strict";n.r(a);var e=function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("div",{staticClass:"auditHistory_main"},[n("ContentHeader",[n("div",{attrs:{slot:"docs"},slot:"docs"},[t._v("记录所有危险命令的执行情况，用于进行规范化管理和快速查询。")])]),n("a-card",[n("div",{staticClass:"search_box"},[n("a-input-search",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入关键字搜索",allowClear:""},on:{search:t.searchTable},model:{value:t.pagination.search_data,callback:function(a){t.$set(t.pagination,"search_data",a)},expression:"pagination.search_data"}},[n("a-select",{staticStyle:{width:"100px"},attrs:{slot:"addonBefore"},slot:"addonBefore",model:{value:t.pagination.search_type,callback:function(a){t.$set(t.pagination,"search_type",a)},expression:"pagination.search_type"}},t._l(t.searchList,(function(a){return n("a-select-option",{key:a.key},[t._v(t._s(a.name))])})),1)],1),n("a-button",{staticStyle:{float:"right"},attrs:{icon:"reload"},on:{click:t.refresh}},[t._v("刷新")])],1),n("a-table",{attrs:{loading:t.tableLoading,pagination:t.pagination,columns:t.columns,"data-source":t.tableData},on:{change:t.onChange},scopedSlots:t._u([{key:"status",fn:function(a){return[n("a-tag",{attrs:{color:"y"==a?"green":"pink"}},[t._v(" "+t._s("y"==a?"已执行":"未执行")+" ")])]}},{key:"block_type",fn:function(a){return[t._v(" "+t._s("confirm"==a?"指令提醒":"指令阻断")+" ")]}}])})],1)],1)},i=[],o=(n("d81d"),n("d3b7"),n("96cf"),n("1da1")),r=n("0977"),s=n("b899"),c=n("6f7c"),u={data:function(){return{tableData:[],pagination:{total:0,current:1,pageSize:10,showTotal:function(t){return"共有 ".concat(t," 条数据")},search_type:"user",search_data:void 0,showSizeChanger:!0,showQuickJumper:!0},tableLoading:!1,columns:[{title:"操作用户/执行用户",dataIndex:"user",ellipsis:!0},{title:"执行主机",dataIndex:"hostname",ellipsis:!0},{title:"执行状态",dataIndex:"status",ellipsis:!0,scopedSlots:{customRender:"status"}},{title:"指令类型",dataIndex:"block_type",ellipsis:!0,scopedSlots:{customRender:"block_type"}},{title:"执行时间",dataIndex:"create_time",ellipsis:!0},{title:"指令名称",dataIndex:"intercept_command",ellipsis:!0},{title:"命令内容",dataIndex:"command",ellipsis:!0}],searchList:[{name:"登录用户",key:"user"}],blockTypeList:[{value:"confirm",label:"指令提醒"},{value:"cancle",label:"指令阻断"}]}},mounted:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(c["a"])(t,"visit-audit-history");case 2:n=a.sent,n&&t.getCommandHistoryData();case 4:case"end":return a.stop()}}),a)})))()},methods:{onChange:function(t){this.pagination.total=t.total,this.pagination.current=t.current,this.pagination.pageSize=t.pageSize,this.getCommandHistoryData()},searchTable:function(t){this.search_data=t,this.pagination.current=1,this.getCommandHistoryData()},refresh:function(){this.getSessionLogData()},getCommandHistoryData:function(){var t=this;this.tableLoading=!0;var a={current:this.pagination.current,pageSize:this.pagination.pageSize};this.pagination.search_data&&("server"==this.pagination.search_type?a.search_type="host__host_name":a.search_type=this.pagination.search_type,a.search_data=this.pagination.search_data),Object(s["c"])(a).then((function(a){200==a.code&&a.data?(t.pagination.total=a.data.total,t.pagination.current=a.data.current,t.pagination.pageSize=a.data.pageSize,a.data.data.map((function(t){t.key=t.id})),t.tableData=a.data.data):t.tableData=[]})).finally((function(){t.tableLoading=!1}))}},components:{ContentHeader:r["a"]}},d=u,l=(n("1f6d"),n("2877")),h=Object(l["a"])(d,e,i,!1,null,"0247b3e4",null);a["default"]=h.exports},b899:function(t,a,n){"use strict";n.d(a,"f",(function(){return i})),n.d(a,"b",(function(){return o})),n.d(a,"a",(function(){return r})),n.d(a,"g",(function(){return s})),n.d(a,"c",(function(){return c})),n.d(a,"d",(function(){return u})),n.d(a,"e",(function(){return d}));var e=n("b775"),i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(e["b"])({url:"session-log/",method:"get",params:t})},o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(e["b"])({url:"session-log/",method:"delete",data:t})},r=window.location.origin+window.API_ROOT+"api/bastion/v0_1/",s=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r+"session-log/guacamole/"+"".concat(t,"/")},c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(e["b"])({url:"command-log/",method:"get",params:t})},u=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(e["b"])({url:"operation-log/",method:"get",params:t})},d=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(e["b"])({url:"session-command-history/",method:"get",params:t})}},bd48:function(t,a,n){}}]);