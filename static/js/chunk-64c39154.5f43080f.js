(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-64c39154"],{"1da1":function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));n("d3b7");function a(t,e,n,a,o,i,s){try{var c=t[i](s),r=c.value}catch(u){return void n(u)}c.done?e(r):Promise.resolve(r).then(a,o)}function o(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var s=t.apply(e,n);function c(t){a(s,o,i,c,r,"next",t)}function r(t){a(s,o,i,c,r,"throw",t)}c(void 0)}))}}},"4e0b":function(t,e,n){},"6f7c":function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));n("d3b7");var a=n("a18c"),o=n("b775"),i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(o["b"])({url:"authentication/",method:"get",params:t})},s=function(){a["a"].push({name:"noAuth"})},c=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Promise((function(n,a){setTimeout((function(){t.$loading.show()}),0),i({action_id:e}).then((function(t){return t.data||s(),n(t.data)})).catch((function(){return s(),n(!1)})).finally((function(){setTimeout((function(){t.$loading.hide()}),0)}))}))}},"7eb9":function(t,e,n){"use strict";var a=n("4e0b"),o=n.n(a);o.a},b899:function(t,e,n){"use strict";n.d(e,"f",(function(){return o})),n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return s})),n.d(e,"g",(function(){return c})),n.d(e,"c",(function(){return r})),n.d(e,"d",(function(){return u})),n.d(e,"e",(function(){return l}));var a=n("b775"),o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(a["b"])({url:"session-log/",method:"get",params:t})},i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(a["b"])({url:"session-log/",method:"delete",data:t})},s=window.location.origin+window.API_ROOT+"api/bastion/v0_1/",c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return s+"session-log/guacamole/"+"".concat(t,"/")},r=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(a["b"])({url:"command-log/",method:"get",params:t})},u=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(a["b"])({url:"operation-log/",method:"get",params:t})},l=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(a["b"])({url:"session-command-history/",method:"get",params:t})}},d021:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"online_main"},[n("ContentHeader",[n("div",{attrs:{slot:"docs"},slot:"docs"},[t._v("当前正在使用堡垒机的登录会话，操作强制下线会中断用户的当前请求链接。")])]),n("a-card",[n("div",{staticClass:"search_box"},[n("a-input-search",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入关键字搜索",allowClear:""},on:{search:t.searchTable},model:{value:t.pagination.search_data,callback:function(e){t.$set(t.pagination,"search_data",e)},expression:"pagination.search_data"}},[n("a-select",{staticStyle:{width:"100px"},attrs:{slot:"addonBefore"},slot:"addonBefore",model:{value:t.pagination.search_type,callback:function(e){t.$set(t.pagination,"search_type",e)},expression:"pagination.search_type"}},t._l(t.searchList,(function(e){return n("a-select-option",{key:e.key},[t._v(t._s(e.name))])})),1)],1),n("a-button",{staticStyle:{float:"right"},attrs:{icon:"reload"},on:{click:t.refresh}},[t._v("刷新")])],1),n("a-table",{attrs:{loading:t.tableLoading,pagination:t.pagination,"row-selection":{selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange},columns:t.columns,"data-source":t.tableData},on:{change:t.onChange},scopedSlots:t._u([{key:"action",fn:function(e,a){return[t.$store.state.btnAuth.btnAuth.bastion_session_off_line?n("a",{on:{click:function(e){return t.offline(a)}}},[t._v("强制下线")]):t._e()]}}])}),t.tableData.length>0?n("a-button",{staticStyle:{float:"left",margin:"-50px 10px 0 0"},attrs:{disabled:0==t.selectedRow.length,icon:"delete"},on:{click:t.batchDelete}},[t._v("批量下线")]):t._e()],1)],1)},o=[],i=(n("d81d"),n("d3b7"),n("96cf"),n("1da1")),s=n("0977"),c=n("b899"),r=n("6f7c"),u={data:function(){return{tableData:[],pagination:{total:0,current:1,pageSize:10,showTotal:function(t){return"共有 ".concat(t," 条数据")},search_type:"user",search_data:void 0,showSizeChanger:!0,showQuickJumper:!0},tableLoading:!1,columns:[{title:"登录用户",dataIndex:"user"},{title:"主机",dataIndex:"host_name"},{title:"IP地址",dataIndex:"host_address",width:"170px"},{title:"系统用户",dataIndex:"login_name"},{title:"开始时间",dataIndex:"start_time"},{title:"操作",key:"action",scopedSlots:{customRender:"action"},align:"center"}],searchList:[{name:"登录用户",key:"user"},{name:"主机",key:"server"}],selectedRowKeys:[],selectedRow:[]}},mounted:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(r["a"])(t,"visit-online-session");case 2:n=e.sent,n&&t.getSessionLogData();case 4:case"end":return e.stop()}}),e)})))()},methods:{onSelectChange:function(t,e){this.selectedRow=e,this.selectedRowKeys=t},getSessionLogData:function(){var t=this;this.tableLoading=!0;var e={current:this.pagination.current,pageSize:this.pagination.pageSize};this.pagination.search_data&&("server"==this.pagination.search_type?e.search_type="host__host_name":e.search_type=this.pagination.search_type,e.search_data=this.pagination.search_data),Object(c["f"])(e).then((function(e){200==e.code&&e.data?(t.pagination.total=e.data.total,t.pagination.current=e.data.current,t.pagination.pageSize=e.data.pageSize,e.data.data.map((function(t){t.key=t.id})),t.tableData=e.data.data,t.selectedRow=[]):t.tableData=[]})).finally((function(){t.tableLoading=!1}))},searchTable:function(t){this.search_data=t,this.pagination.current=1,this.getSessionLogData()},refresh:function(){this.getSessionLogData()},onChange:function(t){this.pagination.total=t.total,this.pagination.current=t.current,this.pagination.pageSize=t.pageSize,this.getSessionLogData()},offline:function(t){var e=this,n={log_name:t.log_name,channel:t.channel};this.$confirm({title:"强制下线确认",content:"请确认是否强制下线此连接?",okType:"danger",onOk:function(){Object(c["b"])({session_list:[n]}).then((function(t){e.$message.success("操作成功"),e.getSessionLogData()}))}})},batchDelete:function(){var t=this;this.$confirm({title:"确认删除该分组吗？",onOk:function(){var e=[];t.selectedRow.map((function(t){e.push({log_name:t.log_name,channel:t.channel})})),Object(c["b"])({session_list:e}).then((function(e){200==e.code&&(t.$message.success(e.message),t.getSessionLogData(),t.selectedRowKeys=[])}))}})}},components:{ContentHeader:s["a"]}},l=u,d=(n("7eb9"),n("2877")),h=Object(d["a"])(l,a,o,!1,null,"77ef36cc",null);e["default"]=h.exports}}]);